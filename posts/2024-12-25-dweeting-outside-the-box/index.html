<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="Dweeting Outside the Box" />
    <meta property="og:type" content="article" />
    <meta property="og:description" content="Demonstration of JavaScript golfing techniques by rendering the "default dweet" in different ways." />
    
    <meta
      property="og:image"
      content="https://ates.dev/posts/2024-12-25-dweeting-outside-the-box/i/default-dweet.png"
    />
    <meta property="og:image:alt" content="" />
    
    <meta property="og:locale" content="en_CA" />
    <meta property="og:site_name" content="ates.dev" />
    <title>ates.dev &middot; Dweeting Outside the Box</title>
    <script>
      (() => {
        const themeOverride = localStorage.getItem('theme-override');
        const lightMode = themeOverride && themeOverride === 'light';
        document.documentElement.classList.toggle('light-mode', lightMode);
      })();
    </script>
    <link
      rel="preload"
      href="/assets/fonts/varelaround-regular-webfont.woff2"
      as="font"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/assets/logos/bluesky.svg"
      as="image"
      crossorigin="anonymous"
    />
    <link
      rel="preload"
      href="/assets/logos/github.svg"
      as="image"
      crossorigin="anonymous"
    />
    <link
      rel="icon"
      type="image/png"
      href="/assets/icons/favicon-96x96.png"
      sizes="96x96"
    />
    <link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg" />
    <link rel="shortcut icon" href="/assets/icons/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/assets/icons/apple-touch-icon.png"
    />
    <meta name="apple-mobile-web-app-title" content="ates.dev" />
    <link rel="manifest" href="/assets/icons/site.webmanifest" />
    <link rel="stylesheet" href="/styles/style.css" />
    <link rel="me" href="https://bsky.app/profile/ates.dev" />
    <link rel="me" href="https://www.dwitter.net/u/magna" />
    <link rel="me" href="https://github.com/atesgoral" />
    <link rel="me" href="https://www.npmjs.com/~atesgoral" />
    <link rel="me" href="https://hackaday.io/atesgoral" />
    <link rel="me" href="https://www.instagram.com/atesgoral" />
    <link rel="me" href="https://stackoverflow.com/users/23501/ates-goral" />
    <link rel="me" href="https://www.linkedin.com/in/atesgoral/" />
    <link rel="me" href="https://twitter.com/atesgoral" />
    <link rel="me" href="https://x.com/atesgoral" />
    <script src="/assets/js/prog.js?bust=1"></script>
  </head>
  <body>
    
    <script src="/lib/render.js"></script>
    
    <script src="/lib/dweet.js"></script>
    
    <header>
      <h1>
        <a href="/">ates.dev</a>
      </h1>
      <nav>
        <ul>
          <li>
            <a href="/">Home</a>
          </li>
          <li>
            <a
              href="/pages/all-posts"
              >Posts</a
            >
          </li>
          <li>
            <a
              href="/pages/all-pages"
              >Pages</a
            >
          </li>
          <li>
            <a
              href="/pages/about"
              >About</a
            >
          </li>
          <li class="break"></li>
          <li>
            <a
              href="https://bsky.app/profile/ates.dev"
              rel="me"
              class="bluesky logo"
              >Bluesky</a
            >
          </li>
          <li>
            <a href="https://github.com/atesgoral" rel="me" class="github logo"
              >GitHub</a
            >
          </li>
        </ul>
      </nav>
    </header>

    <main>
<article>
  <h2>Dweeting Outside the Box</h2>
  <p class="meta">Posted on Dec 25, 2024</p>

  <div class="content"><p>This is a continuation of my <a href="/posts/2024-12-20-intro-to-dwitter">previous post</a> on Dwitter, where I gave an
overview of <a href="https://www.dwitter.net/">Dwitter</a> and a few JavaScript golfing tricks.</p>
<p>The subject was the &quot;default dweet&quot;, which renders 9 bars swaying back and
forth. I'll keep the subject the same, but show rendering those 9 bars in
different ways.</p>
<p>Changing up how you render a scene often opens up new opportunities for visual
effects because it's like stepping into another dimension.</p>
<p>Let's start with recalling the default dweet:</p>
<pre class="dweet play"><code class="language-js">c.width|=0;for(i=9;i--;)x.fillRect(400+i*100+S(t)*300,400,50,200)
</code></pre>
<h3 id="scale" tabindex="-1"><a class="permalink" href="#scale">Scale</a></h3>
<p>Seeing that the bars click into a 50x50 grid, one might be tempted to scale the
context to save on digits. Let's scale the context by 50 and divide all
dimensions by 50:</p>
<pre class="dweet play"><code class="language-js">c.width|=0;x.scale(50,50);for(i=9;i--;)x.fillRect(8+i*2+S(t)*6,8,1,4)
</code></pre>
<p>In this particular case, the extra length of <code>x.scale(50,50)</code> is not offset by
the savings we got from fewer digits. We went from 65 to 69 characters. The
function call overhead (<code>x.scale()</code>) costs more characters than what we save by
using smaller numbers.</p>
<p>In tiny-space coding, intuitions often don't pan out, you just have to try
things for fit.</p>
<h3 id="transform" tabindex="-1"><a class="permalink" href="#transform">Transform</a></h3>
<p>Instead of positioning the elements of the scene by x and y offsets from the top
left, we can use <code>translate()</code> to shift the frame of reference to the center of
the canvas. This can yield two benefits:</p>
<ol>
<li>If there are multiple primitives in the scene, we don't have to repeat adding
offsets to them and therefore save on characters.</li>
<li>We can use <code>rotate()</code> to rotate them around the center of the canvas.</li>
</ol>
<p><code>translate(960, 540)</code> moves the origin <code>(0, 0)</code> to the center of the canvas.
Assuming we want to rotate by angle <code>A</code> using <code>rotate(A)</code>, we can combine
these stacked transformations into a single <code>setTransform()</code> call, saving
precious space. Let's also throw <code>Z</code>, the zoom factor, into the mix. The verbose
form is:</p>
<pre><code class="language-js">x.setTransform(C(A) * Z, S(A) * Z, -S(A) * Z, C(A) * Z, 960, 540);
</code></pre>
<p>Here's the default scene using such combined transformations:</p>
<pre class="dweet play"><code class="language-js">for(c.width|=i=9,Z=1,A=0;i--;x.fillRect(-560+i*100+S(t)*300,-140,50,200))x.setTransform(k=C(A)*Z,z=S(A)*Z,-z,k,960,540)
</code></pre>
<p>Note the <code>k</code> and <code>z</code> variables assignments that reduce repetition. It makes
intuitive sense to assign repeated expressions to variables, but it only saves
space when the expression we're substituting is longer than 2-3 characters, or
when it's repeated for more than 2 times.</p>
<p>This transformation setup enables perfect-loop animations like <a href="https://www.dwitter.net/d/21975">so</a>:</p>
<pre class="dweet play"><code class="language-js">for(c.width|=i=9;i--;x.fillRect(-425+i*100,-103,99-p**.3*50,206))p=t/2%1,Z=2.26+p*7.34,x.setTransform(k=C(A=1.57*p)*Z,z=S(A)*Z,-z,k,960,540)
</code></pre>
<p>And <a href="https://www.dwitter.net/d/13859">so</a>:</p>
<pre class="dweet play"><code class="language-js">eval(unescape(escape`挮睩摴桼㵦㵢㴾房❣汥慲剥捴✺❦楬汒散琧㭳㵓⡴⤻娽㤵〪猪⨴⬵〻甽䌨琩⩚㭸学⡵㸰⥝⠰ⰰⰲ攳ⰲ攳⤻砮瑲慮獦潲洨甬稽猪娬⵺Ⱶⰹ㘰ⰵ㐰⤻景爨椽ㄸ㭩ⴭ㬩硛昨椦ㄩ崨椭㤬ⴲⰱⰴ⤻`.replace(/u(..)/g,"$1%")))
</code></pre>
<p>That gibberish? It's an oft-used compression hack to stuff more than 140
characters into a dweet. The raw characters are encoded as UTF-16 code units,
and then escaped as UTF-8 code units. While this doesn't technically violate the
&quot;140 characters&quot; rule of Dwitter (since the rule was about characters, not bytes),
it's not as pleasing as fitting a dweet into 140 characters without compression.</p>
<p>A quick way to see what the uncompressed version is, is to replace the <code>eval()</code>
with a <code>throw</code>. The <a href="https://beta.dwitter.net/">perpetual-beta version of Dwitter</a> comes with a toggle
to show uncompressed code.</p>
<p>Here's the uncompressed version of the dweet above:</p>
<pre class="dweet"><code class="language-js">c.width|=f=b=>b?'clearRect':'fillRect';s=S(t);Z=950*s**4+50;u=C(t)*Z;x[f(u>0)](0,0,2e3,2e3);x.transform(u,z=s*Z,-z,u,960,540);for(i=18;i--;)x[f(i&1)](i-9,-2,1,4)
</code></pre>
<p>To compress, you can use the wonderful <a href="https://capjs.3d2k.com/">CapJS</a> tool created by the one and
only <a href="https://frankforce.com/">Frank Force</a>.</p>
<h3 id="slice-and-dice" tabindex="-1"><a class="permalink" href="#slice-and-dice">Slice and Dice</a></h3>
<p>We can chop up the bars into tiny squares and perturb their individual positions
or colors to create interesting effects. Like <a href="https://www.dwitter.net/d/7283">this</a> specular highlight:</p>
<pre class="dweet play"><code class="language-js">c.width|=0;for(j=n=10;--j;)for(i=100;i--;X=i%5+j*n+S(t)*30,Y=i/5|0,x.fillStyle=R(r=255-(X-50)**2-Y**2,r,r),x.fillRect(400+X*n,400+Y*n,n,n));
</code></pre>
<p>And <a href="https://www.dwitter.net/d/2384">this</a> twirl:</p>
<pre class="dweet play"><code class="language-js">c.width|=0;for(j=9;j--;)for(i=100;i--;X=i%5+j*10+S(t)*30,Y=i/5|0,x.fillRect(400+X*10+S(t+X+Y)*C(t)*9,400+Y*10,10,10));
</code></pre>
<p>Note the <code>i/5|0</code> expression that exploits the fact that JavaScript floors
numbers prior to performing binary operations like the binary OR used here. This
is <strong>much</strong> shorter than <code>Math.floor(i/5)</code>.</p>
<p>Another technique to note is the elimination of nested loops for X and Y. There
is a single loop and the X and Y values are derived through modulo and division.
This <strong>sometimes</strong> saves space, depending on how many times the X and Y values
are used.</p>
<p>Also note the abuse of the comma operator to perform multiple operations. This
is usually shorter than creating a <code>{}</code> code block with statements separated by
semicolons.</p>
<h3 id="xor" tabindex="-1"><a class="permalink" href="#xor">XOR</a></h3>
<p>We can also play with different <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation">compositing operations</a>. <a href="https://www.dwitter.net/d/22551">Here</a>, I'm
overlaying a bunch of rectangles in XOR mode to let them alternate between black
and white to create the default bars. You have to wait a bit to see the reveal:</p>
<pre class="dweet play"><code class="language-js">c.width=1920
x.globalCompositeOperation='xor'
for(i=18;i--;)x.fillRect(400+i*50+S(t)*300,400+i*S(t/9)**9*200,2e3,200)
</code></pre>
<h3 id="unicode" tabindex="-1"><a class="permalink" href="#unicode">Unicode</a></h3>
<p><a href="https://www.dwitter.net/d/22874">Here's</a> a silly one with printing text &quot;▮▮▮▮▮▮▮▮▮&quot; instead of rendering
rectangles. The scaling makes the characters stretched out to create the bars:</p>
<pre class="dweet play"><code class="language-js">c.width|=0
x.scale(.5,1)
x.font='8cm"'
x.fillText('▮▮▮▮▮▮▮▮▮',800+S(t)*600,600)
</code></pre>
<p>Note the <code>'8cm&quot;'</code> as the font value. The <code>&quot;</code> character creates a word boundary
after the size unit &quot;cm&quot;. While <code>&quot;</code> is not a valid font name, browsers are
forgiving of bad syntax and names. This browser forgiveness is a goldmine
for code golfers - we can use <code>&quot;</code> instead of valid font names like <code>Arial</code> or
<code>sans-serif</code>, saving precious characters.</p>
<h3 id="thematic-end" tabindex="-1"><a class="permalink" href="#thematic-end">Thematic End</a></h3>
<p>And here's a <a href="https://www.dwitter.net/d/29243">thematic end</a> to this post. Not quite the default bars, but
they're hidden in there:</p>
<pre class="dweet play"><code class="language-js">c.width|=0
for(i=17;i--;)for(j=5;j--;)[2057,1,32897,0,2057][j]+87380&1&lt;&lt;i&&x.fillRect(1200-i*50+S(t)*300,400+j*40,50,40)
</code></pre>
<p>A Merry Christmas and a Happy New Year!</p>
</div>

  
</article>
</main>

    <footer>
      <hr />
      <p class="footer meta">
        &copy; Ate<span class="sh">s</span> Göral &middot;
        <a href="https://github.com/atesgoral/ates.dev">src</a> &middot;
        <a href="https://www.11ty.dev/">11ty</a>
      </p>
    </footer>

    <div id="dweet-length-template" style="display: none">
      <div class="length"><span></span>/140</div>
    </div>

    <div id="dweet-player-template" style="display: none">
      <p class="canvas-container">
        <span class="canvas-subcontainer dweet-container">
          <canvas class="white" width="1920" height="1080"></canvas>
        </span>
      </p>
    </div>
  </body>
</html>
